# AIシフトマネージャー

## プロジェクト概要
- **名前**: AIシフトマネージャー / ShiftMgr AI
- **バージョン**: v2.6
- **目的**: 就労継続支援A型事業所向けのAI支援型シフト管理システム
- **主要機能**: 
  - **AIコマンドセンター**: チャット形式でのAIアシスタント機能
  - **シフトスケジュール管理**: 月次カレンダー形式のシフト表示
  - **配置基準自動チェック**: 7.5:1の配置基準違反を自動検出
  - **スタッフ/利用者管理**: 詳細プロフィール表示とスキル管理
  - **実績報告**: KPI統計と帳票ダウンロード機能
  - **リアルタイム統計**: 平均配置比率、未配置人数、稼働率の表示

## 公開URL
- **開発環境**: https://3000-ipt4wtfiyly5o9p3kw99a-8f57ffe2.sandbox.novita.ai
  - **ダッシュボード**: https://3000-ipt4wtfiyly5o9p3kw99a-8f57ffe2.sandbox.novita.ai/
  - **スタッフ管理**: https://3000-ipt4wtfiyly5o9p3kw99a-8f57ffe2.sandbox.novita.ai/staff
  - **実績報告**: https://3000-ipt4wtfiyly5o9p3kw99a-8f57ffe2.sandbox.novita.ai/reports
- **本番環境**: 未デプロイ
- **GitHub**: 未設定

## データ構造

### ダッシュボード
- **シフトデータモデル**:
  - スタッフ情報（ID、名前、役職、アバター）
  - スケジュール（時間、場所、交通手段）
  - ハイライト（応援配置、配置基準違反）
  - 日次集計（利用者数、職員数、配置比率）

### スタッフ管理
- **ユーザー情報**:
  - 基本情報（ID、名前、連絡先、入社日）
  - スキル情報（スキル名、レベル1-5）
  - 特性タグ（立ち仕事NG、聴覚過敏など）
  - 人間関係（NGペア、推奨ペア）
  - 契約出勤日（月〜日の7日間）

### 実績報告
- **KPI統計データ**:
  - 稼働率（95%、目標100%）
  - 平均配置比率（8.2:1、基準7.5:1）
  - 未充足日数（0日）
- **帳票データ**:
  - サービス提供実績記録票（月次）
  - 業務日報（日次）
  - 送迎運行記録（随時）

- **ストレージ**: 現在はモックデータ（メモリ内）
- **今後の拡張**: Cloudflare D1データベースへの移行を推奨

## 完成した機能

### ✅ ダッシュボード (/)
1. **AIコマンドセンターサイドバー**
   - チャット形式のAI会話インターフェース
   - 実績取込・日報出力・シフト確定ボタン
   - 音声入力とファイル添付対応のコマンド入力
   - 配置基準違反の自動検出と修正案提案

2. **シフトスケジュールグリッド**
   - 月次カレンダー形式の表示
   - スタッフ別/現場別の表示切り替え
   - 週7日分のシフト詳細表示
   - 場所、時間、交通手段の情報表示
   - 配置基準違反のハイライト表示
   - 応援配置のグリーンハイライト
   - 日次集計フッター（利用者数、職員数、配置比率）

3. **統計カード**
   - 平均配置比率: 7.6:1（警告表示）
   - 未配置人数: 残り3名（エラー表示）
   - 稼働率: 94%（成功表示）

4. **シフト編集モーダル**
   - 時間範囲の編集
   - 場所の選択
   - ステータス管理（確定済み/仮押さえ）

### ✅ スタッフ管理 (/staff)
1. **ユーザーリスト表示**
   - 左サイドバーのユーザー一覧
   - 社員/利用者の切り替え
   - 検索バー（UI実装済み）

2. **詳細プロフィール表示**
   - 基本情報・連絡先セクション
   - 契約出勤日の視覚化
   - 送迎必要性トグル
   - スキル・特性セクション（星評価表示）
   - 人間関係セクション（NGペア・推奨ペア）

3. **ナビゲーション**
   - タブナビゲーション（基本情報、スキル・特性、人間関係、活動履歴）
   - 編集・削除ボタン（UI実装済み）

### ✅ 実績報告 (/reports)
1. **ライトテーマUI**
   - クリーンで読みやすいライトカラースキーム
   - ビジネス文書に適したデザイン

2. **KPI統計カード**
   - **稼働率カード**:
     - ドーナツチャート表示（95%達成）
     - 目標100%との比較
     - 実績285時間の表示
     - プログレスバー
     - 前月比+2.4%
   - **平均配置比率カード**:
     - 大きな数値表示（8.2:1）
     - 基準達成バッジ（基準7.5:1）
   - **未充足日数カード**:
     - 0日表示（正常状態）
     - グリーンアクセントの左ボーダー
     - 減算対象なしのステータス

3. **帳票一覧セクション**
   - グリッド/リスト表示切り替え
   - 3種類の帳票カード:
     - **サービス提供実績記録票**（月次）
     - **業務日報**（日次）
     - **送迎運行記録**（随時）
   - 各カードに:
     - カラーアイコン（青/オレンジ/紫）
     - 頻度バッジ（月次/日次/随時）
     - 説明文
     - プレビューボタン
     - ダウンロードボタン

4. **ヘッダー機能**
   - 2023年10月度の表示
   - 期間変更ボタン
   - 一括ダウンロードボタン

## 未実装の機能

### ダッシュボード
1. ❌ シフトのドラッグ&ドロップ編集
2. ❌ AIコマンド実行機能
3. ❌ 実績取込・日報出力・シフト確定の実装
4. ❌ シフト編集モーダルの保存機能
5. ❌ 現場別表示への切り替え
6. ❌ 通知機能

### スタッフ管理
1. ❌ ユーザー検索機能
2. ❌ ユーザー編集・削除機能
3. ❌ タブ切り替え機能（現在は基本情報タブのみ表示）
4. ❌ 活動履歴タブのコンテンツ
5. ❌ ユーザー追加機能
6. ❌ リアルタイム検索フィルタリング

### 実績報告
1. ❌ 期間変更機能
2. ❌ プレビュー機能（帳票のPDFプレビュー）
3. ❌ ダウンロード機能（帳票のPDFダウンロード）
4. ❌ 一括ダウンロード機能
5. ❌ 帳票の動的生成
6. ❌ グリッド/リスト表示切り替え

### 共通
1. ❌ データベース連携（D1）
2. ❌ 認証機能
3. ❌ CSVインポート/エクスポート機能
4. ❌ ダークモード切り替え

## 推奨される次のステップ

### 優先度: 高
1. **データベース統合**: Cloudflare D1を使用してデータを永続化
   - スタッフ/利用者マスターテーブル
   - シフトテーブル
   - 配置基準テーブル
   - 実績データテーブル
2. **帳票生成機能**: PDFライブラリを使用した帳票の動的生成
3. **シフト編集機能**: ドラッグ&ドロップでのシフト変更
4. **配置基準チェック**: リアルタイムでの配置基準違反検出

### 優先度: 中
5. **AIコマンド実装**: 自然言語でのシフト操作
6. **CSV機能**: シフトデータのインポート/エクスポート
7. **認証機能**: 管理者ログイン機能
8. **通知機能**: 配置基準違反の通知
9. **帳票プレビュー**: インラインPDFビューア

### 優先度: 低
10. **レスポンシブ対応の強化**: モバイル表示の最適化
11. **活動履歴**: スタッフの勤務履歴表示
12. **レポート機能**: 月次・年次のレポート生成
13. **ダークモード切り替え**: ユーザー設定でのテーマ変更

## ユーザーガイド

### ダッシュボードの使い方
このアプリケーションは、障害者就労支援施設（A型事業所）向けのAI支援型シフト管理システムです。

1. **AIコマンドセンター** (左サイドバー):
   - AIアシスタントとチャット形式で対話
   - 配置基準違反の自動検出と修正案の提案
   - コマンド入力欄でシフト操作や質問が可能

2. **シフトグリッド** (右側メインエリア):
   - 月次カレンダー形式でシフトを表示
   - 各セルにはスタッフ名、時間、場所、交通手段を表示
   - 配置基準違反は赤色でハイライト
   - 応援配置はグリーンでハイライト
   - 日次集計フッターで配置比率を確認

3. **統計カード** (ヘッダー右側):
   - 平均配置比率: 7.5:1を目標とする配置基準
   - 未配置人数: シフト未割り当ての人数
   - 稼働率: スタッフの稼働状況

### スタッフ管理の使い方
1. **ユーザーリストの表示**: 左サイドバーにユーザーが一覧表示
2. **ユーザー選択**: ユーザーをクリックすると詳細情報が表示
3. **情報確認**: 
   - 基本情報: 連絡先、住所、契約出勤日、送迎の必要性
   - スキル: 組立作業、清掃、PC入力などのスキルレベル
   - 人間関係: NGペアや推奨ペアの確認

### 実績報告の使い方
1. **KPI統計の確認**:
   - 稼働率、平均配置比率、未充足日数を一目で確認
   - ドーナツチャートで目標達成度を可視化
   - 基準達成/未達成のステータス表示

2. **帳票のダウンロード**:
   - 必要な帳票カードを選択
   - プレビューボタンで内容確認
   - DLボタンでPDFダウンロード
   - 一括ダウンロードで全帳票を取得

3. **期間変更**:
   - ヘッダーの「変更」ボタンをクリック
   - 表示する月度を選択

### デザインの特徴

#### ダッシュボード・スタッフ管理（ダークテーマ）
- **ダークテーマ**: 目に優しい暗色デザイン
- **グリーンアクセント**: プライマリカラー「#2bee79」で重要な要素を強調
- **配色システム**:
  - Primary: `#2bee79` (グリーン)
  - Violation: `#fb4e6d` (ローズレッド - 配置基準違反)
  - Warning: `#fbbd23` (アンバーイエロー - 警告)
  - Member Badge: `#60a5fa` (ブルー - 利用者)
  - Staff Badge: `#34d399` (グリーン - 社員)

#### 実績報告（ライトテーマ）
- **ライトテーマ**: ビジネス文書に適したクリーンなデザイン
- **グリーンアクセント**: プライマリカラー「#2bee79」
- **配色システム**:
  - Primary: `#2bee79` (グリーン)
  - Background Light: `#f6f8f7` (明るいグレー)
  - Surface Light: `#ffffff` (白)
  - Text Main: `#111814` (ダークグレー)
  - Text Secondary: `#618971` (グリーン系グレー)
- **Material Symbolsアイコン**: Google Fontsのアイコンを使用
- **日本語対応**: Noto Sans JPフォントで美しい日本語表示

## デプロイ情報
- **プラットフォーム**: Cloudflare Pages
- **ステータス**: ✅ 開発環境で稼働中
- **技術スタック**: 
  - バックエンド: Hono + TypeScript
  - フロントエンド: Tailwind CSS (CDN)
  - アイコン: Material Symbols (Google Fonts)
  - フォント: Spline Sans + Noto Sans JP
- **バンドルサイズ**: 106.79 KB
- **最終更新日**: 2025-12-12

## 開発コマンド
```bash
# 開発サーバー起動（Vite）
npm run dev

# ビルド
npm run build

# サンドボックス開発サーバー起動（PM2）
npm run clean-port
pm2 start ecosystem.config.cjs

# PM2管理
pm2 list                    # サービス一覧
pm2 logs webapp --nostream  # ログ確認
pm2 restart webapp          # 再起動
pm2 delete webapp           # 削除

# デプロイ（Cloudflare Pages）
npm run deploy:prod

# Git操作
npm run git:status
npm run git:commit "コミットメッセージ"
```

## プロジェクト構造
```
webapp/
├── src/
│   ├── index.tsx          # メインアプリケーション
│   │                      # - / : ダッシュボード（ダークテーマ）
│   │                      # - /staff : スタッフ管理（ダークテーマ）
│   │                      # - /reports : 実績報告（ライトテーマ）
│   └── renderer.tsx       # レンダラー設定
├── public/
│   └── static/
│       └── style.css      # カスタムCSS（予約）
├── dist/                  # ビルド出力
│   └── _worker.js         # Cloudflare Worker
├── ecosystem.config.cjs   # PM2設定
├── wrangler.jsonc         # Cloudflare設定
├── package.json           # 依存関係
└── README.md              # このファイル
```

## 画面遷移
```
/ (ダッシュボード - ダークテーマ)
├── AIコマンドセンター
│   ├── チャットインターフェース
│   ├── コマンド入力
│   └── 実績取込/日報出力/シフト確定ボタン
└── シフトスケジュールグリッド
    ├── スタッフ別/現場別切り替え
    ├── 統計カード（配置比率、未配置、稼働率）
    ├── シフトグリッド（7日分）
    ├── 日次集計フッター
    └── シフト編集モーダル

/staff (スタッフ管理 - ダークテーマ)
├── ユーザーリスト（左サイドバー）
│   ├── 検索バー
│   └── 社員/利用者切り替え
└── 詳細プロフィール（右側）
    ├── 基本情報
    ├── スキル・特性
    ├── 人間関係
    └── 活動履歴

/reports (実績報告 - ライトテーマ)
├── ヘッダー
│   ├── 期間選択（2023年10月度）
│   └── 一括ダウンロードボタン
├── KPI統計カード
│   ├── 稼働率（95%、ドーナツチャート）
│   ├── 平均配置比率（8.2:1）
│   └── 未充足日数（0日）
└── 帳票一覧
    ├── サービス提供実績記録票（月次）
    ├── 業務日報（日次）
    └── 送迎運行記録（随時）
```

## 技術的な特徴
- **サーバーレス**: Cloudflare Workersで動作
- **エッジファースト**: グローバルエッジネットワークで高速配信
- **ゼロビルドフロントエンド**: CDNベースのTailwind CSS
- **型安全**: TypeScriptによる開発
- **軽量**: 106.79 KBのワーカーバンドル
- **マルチテーマ**: ダークテーマ（ダッシュボード・スタッフ管理）とライトテーマ（実績報告）の切り替え
